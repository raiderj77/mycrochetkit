rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ===== PUBLIC READ: Co-Op Board =====
    // The co-op board page reads available spots without auth
    match /postcards/{postcardId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    match /coopSpots/{spotId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // ===== PUBLIC READ: Redemption tracking =====
    match /redemptions/{redemptionId} {
      allow read: if true;
      allow create: if true;  // customers redeem coupons
      allow update, delete: if request.auth != null;
    }
    
    // ===== PUBLIC WRITE: Quote submissions =====
    match /quotes/{quoteId} {
      allow create: if true;  // anyone can submit a quote
      allow read, update, delete: if request.auth != null;
    }
    
    // ===== AUTHENTICATED: Everything else =====
    // Dashboard data requires login
    match /prospects/{prospectId} {
      allow read, write: if request.auth != null;
    }
    match /campaigns/{campaignId} {
      allow read, write: if request.auth != null;
    }
    match /tasks/{taskId} {
      allow read, write: if request.auth != null;
    }
    match /invoices/{invoiceId} {
      allow read, write: if request.auth != null;
    }
    match /territories/{territoryId} {
      allow read, write: if request.auth != null;
    }
    match /reports/{reportId} {
      allow read, write: if request.auth != null;
    }
    
    // Catch-all: require auth
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
